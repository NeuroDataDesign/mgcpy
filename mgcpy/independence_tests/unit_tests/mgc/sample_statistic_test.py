import pytest
import numpy as np

from mgcpy.independence_tests.mgc.mgc import MGC


def test_mgc_sample_linear():
    X = np.array([0.07487683, -0.18073412, 0.37266440, 0.06074847, 0.76899045,
                  0.51862516, -0.13480764, -0.54368083, -0.73812644, 0.54910974]).reshape(-1, 1)
    Y = np.array([-1.31741173, -0.41634224, 2.24021815, 0.88317196, 2.00149312,
                  1.35857623, -0.06729464, 0.16168344, -0.61048226, 0.41711113]).reshape(-1, 1)

    mgc_statistic = 0.4389398
    optimal_scale = [10, 10]

    mgc = MGC(X, Y, None)
    mgc_statistic_res, independence_test_metadata = mgc.test_statistic()

    assert np.allclose(mgc_statistic, mgc_statistic_res)
    assert np.allclose(optimal_scale, independence_test_metadata["optimal_scale"])


def test_mgc_sample_non_linear():
    # spiral data
    X = np.array([1.19076532, -4.89949601, -1.04671781, -0.78870398, -4.96541929, -3.47913731, 0.61608779, -1.04636872, 0.01792450, -2.99958358, 1.99093892, 2.02476848, -1.00291164, 3.84247195, -0.97867784, 0.06643890, -2.04553564, 3.95870375, -2.60045257, -1.04668339, -0.92919140, -2.94754180, -0.48332416, 1.26781216, 0.13068389,
                  0.17426063, 1.51532887, -0.65853037, 1.83957953, -2.47333005, 0.13855163, -3.51847437, -4.94476873, -0.99116531, 0.94505361, 0.02117659, -0.98862767, -1.04662608, -0.47863973, -4.95602679, -2.44573834, -0.57811752, 3.35735796, -2.77334193, -2.66310047, 0.12282333, 1.84287144, 3.17489424, 1.69930914, 3.24924651]).reshape(-1, 1)
    Y = np.array([-1.40947688, 1.04194197, 0.40771759, -3.16609585, 0.62368044, 3.77762740, 4.09967197, -0.45247854, 0.21346485, -1.51231169, 0.01814165, 0.63590620, -0.17373739, 0.88791421, 0.29489715, -0.25420314, 1.60145057, 0.70182757, -2.24325328, -0.52412790, 3.37903326, -1.25394361, -2.56437048, -1.63174998, 0.40462931,
                  1.49760321, 1.42923722, 0.23255328, 1.35751771, -2.10603089, 2.85151995, 3.03632266, 0.48248123, 0.54841016, 2.22176329, 0.77264609, 0.41259043, -0.50495140, -1.44860013, 1.20476810, -1.94893291, -1.52795955, -2.06691591, -1.83411979, 1.07099382, 0.24942774, 1.43385633, 2.94960357, -3.34529118, 3.16868061]).reshape(-1, 1)

    mgc_statistic = 0.1991505
    optimal_scale = [2, 6]

    mgc = MGC(X, Y, None)
    mgc_statistic_res, independence_test_metadata = mgc.test_statistic()

    assert np.allclose(mgc_statistic, mgc_statistic_res)
    assert np.allclose(optimal_scale, independence_test_metadata["optimal_scale"])
